#!/bin/bash

set -x

export ARCH=arm
export CROSS_COMPILE=arm-linux-gnueabihf-
export LOADADDR=0x8000
export LOCALVERSION="-replicookie"
export KBUILD_IMAGE=uImage

# get wl18xx firmware binaries
cd ..
git clone http://git.ti.com/git/wilink8-wlan/wl18xx_fw.git
git clone https://github.com/krtkl/wlconf.git
cp wlconf/wl18xx-conf-default.bin snickerdoodle-linux/firmware/ti-connectivity/wl18xx-conf.bin
cp wl18xx_fw/wl18xx-fw-4.bin snickerdoodle-linux/firmware/ti-connectivity/wl18xx-fw-4.bin
cd -

JOBS=$((`nproc`+1))

make -j${JOBS} snickerdoodle_defconfig
make -j${JOBS} scripts
make -j${JOBS} uImage modules